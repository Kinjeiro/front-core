<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for common\utils\decorators\bem-component.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../../prettify.css" />
    <link rel="stylesheet" href="../../../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../../../index.html">all files</a> / <a href="index.html">common/utils/decorators/</a> bem-component.js
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>47/47</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">62.5% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>20/32</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>8/8</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>35/35</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">/* eslint-disable no-param-reassign */
import React from 'react';
import PropTypes from 'prop-types';
&nbsp;
import bemBlock from '../bem';
&nbsp;
// /* camelcase to hyphens*/
// function camelCaseToDash(str) {
//   return str.replace(/([a-z])([A-Z])/g, '$1-$2').toLowerCase();
// }
&nbsp;
export function addClassName(currentClassName, ...newClassNames) {
  const resultClasses = newClassNames.reduce((resultArray, newClassName) =&gt; {
    <span class="missing-if-branch" title="else path not taken" >E</span>if (newClassName &amp;&amp; resultArray.indexOf(newClassName) &lt; 0) {
      resultArray.push(newClassName);
    }
    return resultArray;
  }, c</span>urrentClassName ? <span class="branch-0 cbranch-no" title="branch not covered" >currentClassName.split(' ') : [])
    .join(' ');
&nbsp;
  return resultClasses !== currentClassName
    ? resultClasses
    : <span class="branch-1 cbranch-no" title="branch not covered" >currentClassName;</span>
}
&nbsp;
function getTheme(instance) {
  return instance.props.theme || instance.context.theme;
}
&nbsp;
/*
 * интегрирует в компонент переменные
 * bem - инстантс от https://github.com/albburtsev/bem-cn
 * fullClassName - css классы bem + theme
 *
 * так же добавляет модификатор theme (из contextTypes)
 * options - string (componentName) \\ object {
     componentName,
     wrapper = true,
     theme = true,
 * }
*/
function bemDecorator(options) <span class="branch-1 cbranch-no" title="branch not covered" ><span class="branch-1 cbranch-no" title="branch not covered" >{</span></span>
  l</span>et finalOptions = options || <span class="branch-1 cbranch-no" title="branch not covered" >{};
  <span class="missing-if-branch" title="else path not taken" >E</span>if (typeof finalOptions === 'string') {
    finalOptions = {
      componentName: finalOptions,
    };
  }
  const {
    componentName,
    wrapper = true,
    theme = true,
  } = finalOptions;
&nbsp;
  return (targetClass) =&gt; {
    // todo @ANKU @LOW - при минификации во время прода имя класса меняется (targetClass.name) - либо использовать
    /*
     new UglifyJsPlugin({
       mangle: {
        keep_fnames: true
       }
     }),
     либо https://github.com/babel/minify/tree/master/packages/babel-plugin-minify-mangle-names#options
    */
    // const classBem = bemBlock(componentName || targetClass.name);
    const classBem = bemBlock(componentName);
    // targetClass.prototype.bem = bemBlock(componentName || camelCaseToDash(targetClass.name));
    targetClass.prototype.bem = (...args) =&gt; {
      const result = classBem(...args);
      return typeof result === 'function'
        // убираем оборачивание в функцию, чтобы сразу на выходе была стринга (нам объект-функция для расширения не нужен)
        // многие компоненты с className не расчитывают на объект-функцию
        ? result()
        : <span class="branch-1 cbranch-no" title="branch not covered" >result;</span>
    };
&nbsp;
    // так как bem - это функция для создания других classNames, то для блока нужна вызвать с пустыи парпаметром
    targetClass.prototype.fullClassName = null;
&nbsp;
    <span class="missing-if-branch" title="else path not taken" >E</span>if (targetClass.prototype.render) {
      targetClass.contextTypes = {
        ...targetClass.contextTypes,
        theme: PropTypes.string,
      };
&nbsp;
      const originalRender = targetClass.prototype.render;
      targetClass.prototype.render = function renderWrapper() {
        const targetInstance = this;
&nbsp;
        let fullClassName = targetInstance.props.className;
        <span class="missing-if-branch" title="else path not taken" >E</span>if (theme) {
          fullClassName = addClassName(
            fullClassName,
            targetInstance.bem({ theme: getTheme(targetInstance) }),
          );
        }
        targetInstance.fullClassName = fullClassName;
&nbsp;
        let result = originalRender.call(targetInstance);
&nbsp;
        <span class="missing-if-branch" title="else path not taken" >E</span>if (wrapper) {
          result = React.createElement(
            wrapper === true ? 'div' : <span class="branch-1 cbranch-no" title="branch not covered" >wrapper,</span>
            {
              className: fullClassName,
            },
            result,
          );
        }
        return result;
      };
    }
  };
}
&nbsp;
export default bemDecorator;
&nbsp;
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Tue Oct 30 2018 19:53:47 GMT+0300 (RTZ 2 (зима))
</div>
</div>
<script src="../../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../../sorter.js"></script>
</body>
</html>
